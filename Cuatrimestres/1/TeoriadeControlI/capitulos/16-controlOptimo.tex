\chapter{Introducción al control óptimo}

    Sea el sistema descrito por la representación de estado:

    \begin{equation} \label{eq:conop1}
        \frac{dx}{dt} = A x + b u
    \end{equation}

    donde $A \in \mathbbm{R}^{n \times n}$, $b \in \mathbbm{R}^{n \times n}$, con condiciones iniciales $x(0) = x_0 \in \mathbbm{R}^n$; se desea minimizar el indice de desempeño:

    \begin{equation} \label{eq:conop2}
        J(x, u) = \frac{1}{2} \int_0^{\infty} \left( x^T Q x + \rho u^2 \right) dt
    \end{equation}

    donde $\rho > 0$ y $Q = Q^T \ge 0$, a lo largo de las trayectorias solución de la ecuación~\ref{eq:conop1}. Es decir se desea minimizar la ecuación~\ref{eq:conop2} con las restricciones de la ecuación~\ref{eq:conop1}.

    Este problema de minimización con restricciones se va a resolver usando los multiplicadores de Lagrange.

    El indice de desempeño aumentado es:

    \begin{equation*}
        Ja(x, u, \lambda) = \int_0^{\infty} \left( \frac{1}{2}  \left( x^T Q x + \rho u^2 \right) + \lambda^T \left( Ax + bu - \frac{dx}{dt} \right) \right)
    \end{equation*}

    Definiendo los siguientes funcionales:

    \begin{description}
        \item [Lagrangiano]
        \begin{equation}
            \mathscr{L}(x, u, \lambda, t) = \frac{1}{2} \left( x^T Q x + \rho u^2 \right)
        \end{equation}
        \item [Hamiltoniano]
        \begin{equation}
            \mathscr{H}(x, u, \lambda, t) = \mathscr{L}(x, u, \lambda, t) + \lambda^T (A x + b u)
        \end{equation}
    \end{description}

    se obtiene:

    \begin{equation}
        Ja(x, u, \lambda) = \int_0^{\infty} \left( \mathscr{H}(x, u, \lambda, t) - \lambda^T \dot{x} \right) dt
    \end{equation}

    si tenemos que $v =\begin{pmatrix} x \\ u \\ \lambda \end{pmatrix}$, podemos ver al indice de desempeño aumentado como una función:

    \begin{equation*}
        Ja(x, u, \lambda) = \int_0^{\infty} f(v, \dot{v}, t) dt
    \end{equation*}

    Sabemos que la ecuación de Euler es:

    \begin{equation}
        \frac{\partial f(v, \dot{v}, t)}{\partial v} - \frac{d}{dt} \left( \frac{\partial f(v, \dot{v}, t)}{\partial \dot{v}} \right) = 0
    \end{equation}

    pero sabemos que $v$ es un vector con 3 funciones, por lo que al derivar con respecto a cada una tendremos:

    \begin{enumerate}
        \item Con respecto a $x$:

        \begin{eqnarray*}
            \frac{\partial f}{\partial x} - \frac{d}{dt} \left( \frac{\partial f}{\partial \dot{x}} \right) & = & 0 \\
            \frac{\partial \mathscr{H}}{\partial x} - \frac{d}{dt} \left( -\lambda \right) & = & 0 \\
            Q x + A^T \lambda + \frac{d \lambda}{dt} & = & 0
        \end{eqnarray*}

        lo cual implica:

        \begin{equation} \label{eq:conop3}
            - \frac{d \lambda}{dt} = Q x + A^T \lambda
        \end{equation}

        \item Con respecto a $u$:

        \begin{eqnarray*}
            \frac{\partial f}{\partial u} - \frac{d}{dt} \left( \frac{\partial f}{\partial \dot{u}} \right)  & = & 0 \\
            \frac{\partial \mathscr{H}}{\partial u} - \frac{d}{dt} \left( 0 \right) & = & 0 \\
            \rho u + \lambda^T b & = & 0
        \end{eqnarray*}

        lo cual implica:

        \begin{equation} \label{eq:conop4}
            u = - \rho^{-1} b^T \lambda
        \end{equation}

        \item Con respecto a $\lambda$:

        \begin{eqnarray*}
            \frac{\partial f}{\partial \lambda} - \frac{d}{dt} \left( \frac{\partial f}{\partial \dot{\lambda}} \right) & = & 0 \\
            \frac{\partial \mathscr{H}}{\partial \lambda} - \frac{dx}{dt} - \frac{d}{dt} \left( 0 \right) & = & 0 \\
            A x + b u -\frac{dx}{dt} = 0
        \end{eqnarray*}

        lo cual implica:

        \begin{equation} \label{eq:conop5}
            \frac{dx}{dt} = A x + b u
        \end{equation}
    \end{enumerate}

    De las ecuaciones~\ref{eq:conop3},~\ref{eq:conop4} y~\ref{eq:conop5} podemos obtener el siguiente resultado:

    \begin{equation} \label{eq:conop6}
        \begin{pmatrix}
            \dot{x} \\
            \dot{\lambda}
        \end{pmatrix} =
        \begin{pmatrix}
            A & -b \rho^{-1} b^T \\
            - Q & - A^T
        \end{pmatrix}
        \begin{pmatrix}
            x \\
            \lambda
        \end{pmatrix}
    \end{equation}

    de donde $M = \begin{pmatrix} A & -b \rho^{-1} b^T \\ - Q & - A^T \end{pmatrix}$ es la matriz de Hamilton, y las condiciones de frontera del sistema son $x(0) = x_0$ y $\lim_{t \to \infty} \lambda(t) = 0$.

    \begin{figure}
        \centering
        \includegraphics[width=0.7\textwidth]{./imagenes/trayectoria3d.pdf}
        \caption{\label{fig:trayectoriaoptima}Trayectoria óptima solución del sistema.}
    \end{figure}

    Si bien hemos usado a $\lambda$, aun no hemos mencionado que esta variable representa el coestado del sistema y si bien las condiciones de frontera del sistema son correctas, cabe mencionar que lo que realmente queremos es que $x(0) = x_0$ y $\lim_{t \to \infty} x(t) = 0$, por lo que hace falta relacionar al estado del sistema, $x(t)$, con el coestado, $\lambda(t)$.

    En base a la ecuación~\ref{eq:conop4} se propone que la solución sea una realimentación de estado, para esto se propone que el estado $x$ y el coestado $\lambda$ esten relacionados por una matriz $P$, esto es:

    \begin{equation} \label{eq:conop7}
        \lambda = P x
    \end{equation}

    Por lo que de las ecuaciones~\ref{eq:conop6} y~\ref{eq:conop7}, podemos obtener que:

    \begin{equation*}
        \begin{pmatrix}
            I \\
            P
        \end{pmatrix} \dot{x}=
        \begin{pmatrix}
            A & -b \rho^{-1} b^T \\
            - Q & - A^T
        \end{pmatrix}
        \begin{pmatrix}
            I \\
            P
        \end{pmatrix} x
    \end{equation*}

    si premultiplicamos esta expresión con $\begin{pmatrix} P & -I \end{pmatrix}$, obtendremos:

    \begin{equation*}
        0 =
        \begin{pmatrix}
            P A + Q & -P b \rho^{-1} b^T + A^T
        \end{pmatrix}
        \begin{pmatrix}
            I \\
            P
        \end{pmatrix} x
    \end{equation*}

    \begin{equation*}
        0 = \left( A^T P + P A - P b \rho^{-1} b^T P + Q \right) x \quad \forall x \text{ solución del sistema~\ref{eq:conop1}}
    \end{equation*}

    Por lo que hemos llegado a la ecuación algebraica de Riccati:

    \begin{equation} \label{eq:conop8}
        A^T P + P A - P b \rho^{-1} b^T P + Q = 0
    \end{equation}

    siendo la ley de control óptimo (de las ecuaciones~\ref{eq:conop4} y~\ref{eq:conop7}):

    \begin{equation} \label{eq:conop9}
        u = -f_*^T x
    \end{equation}

    donde $f_*^T = \rho^{-1} b^T P$.

    Note que de las ecuaciones~\ref{eq:conop8} y~\ref{eq:conop9}, se obtiene la ecuación de Lyapunov del sistema en lazo cerrado:

    \begin{eqnarray}
        A^T P + P A - P b f_*^T & = & -Q \nonumber \\
        A^T P + P \left( A - b f_*^T \right) & = & - Q \nonumber \\
        \left( A - b f_*^T \right)^T P + P \left( A - b f_*^T \right) & = & - \left( Q + f_* b^T P \right) \nonumber \\
        \left( A - b f_*^T \right)^T P + P \left( A - b f_*^T \right) & = & - \left( Q + f_* \rho f_*^T \right)
    \end{eqnarray}

    En donde la expresión del lado derecho debe ser $\left( Q + f_* b^T P \right) = \left( Q + f_* b^T P \right)^T \ge 0$, por lo que tambien pediremos que $P$ sea simétrica y semidefinida positiva ($P = P^T \ge 0$).

    Como nota final, tan solo hacemos notar que el sistema realimentado queda:

    \begin{equation}
        \frac{dx}{dt} = (A - b f_*^T) x
    \end{equation}

    Y que una manera gráfica de interpretar la minimización del indice de desempeño es de manera grafica.

    \begin{figure}
        \centering
        \includegraphics[width=0.7\textwidth]{./imagenes/trayectorias3d.pdf}
        \caption{\label{fig:trayectoriaoptima}Trayectoria óptima solución del sistema del estado y coestado.}
    \end{figure}

    \section{Propiedades de la matriz de Hamilton}

        \subsection{La controlabilidad del par $(A, b)$, garantiza la existencia de la solución del problema de control óptimo.}

        Definiendo la siguiente matriz de cambio de base:

        \begin{equation}
            T =
            \begin{pmatrix}
                I & 0 \\
                P & I
            \end{pmatrix}, \quad T^{-1} =
            \begin{pmatrix}
                I & 0 \\
                -P & I
            \end{pmatrix}
        \end{equation}

        y aplicando este cambio de base, la representación de estado de la ecuación~\ref{eq:conop6} queda:

        \begin{equation} \label{eq:conop10}
            \begin{pmatrix}
                \dot{x} \\
                \dot{\bar{\lambda}}
            \end{pmatrix} =
            \begin{pmatrix}
                A - b f_*^T & -b \rho^{-1} b^T \\
                -0 & - (A - b f_*^T)^T
            \end{pmatrix}
            \begin{pmatrix}
                x \\
                \bar{\lambda}
            \end{pmatrix}
        \end{equation}

        En efecto:

        \begin{equation*}
            \begin{pmatrix}
                x \\
                \bar{\lambda}
            \end{pmatrix} =
            \begin{pmatrix}
                I & 0 \\
                -P & I
            \end{pmatrix}
            \begin{pmatrix}
                x \\
                \lambda
            \end{pmatrix}
        \end{equation*}

        \begin{eqnarray*}
            T^{-1} M T & = &
            \begin{pmatrix}
                I & 0 \\
                -P & I
            \end{pmatrix}
            \begin{pmatrix}
                A & -b \rho^{-1} b^T \\
                -Q & P b \rho^{-1} b^T - A^T
            \end{pmatrix}
            \begin{pmatrix}
                I & 0 \\
                P & I
            \end{pmatrix} \\
            & = &
            \begin{pmatrix}
                A & -b \rho^{-1} b^T \\
                -(PA + Q) & P b \rho^{-1} b^T - A^T
            \end{pmatrix}
            \begin{pmatrix}
                I & 0 \\
                P & I
            \end{pmatrix} \\
            & = &
            \begin{pmatrix}
                A - b \rho^{-1} b^T P & -b \rho^{-1} b^T \\
                -(A^TP + PA - Pb \rho^{-1} b^T P + Q) & - (A^T + P b \rho^{-1} b^T)
            \end{pmatrix}
        \end{eqnarray*}

        si sustituimos las ecuaciones~\ref{eq:conop8} y~\ref{eq:conop9}, tendremos:

        \begin{equation*}
            T^{-1} M T =
            \begin{pmatrix}
                A - b f_*^T & - b \rho^{-1} b^T \\
                0 & -(A - b f_*^T)^T
            \end{pmatrix}
        \end{equation*}

        \begin{nota}
            Note que el determinante de la matrix Hamiltoniana es igual al de esta matriz:

            \begin{eqnarray*}
                \det{(sI - M)} & = & \det{(sI - T^{-1}MT)} \\
                 & = & (-1)^n \pi(s) \pi(-s)
            \end{eqnarray*}

            donde $\pi(s) = \det{(sI - (A - b f_*^T))}$, es decir que los valores propios de $M$ son simetricos con respecto al eje $j\omega$.
        \end{nota}

        Resolviendo el sistema de la ecuación~\ref{eq:conop10} en el horizonte de tiempo $[0, T]$ y con $A_{f_*} = A - b f_*^T$:

        \begin{eqnarray}
            \bar{\lambda}(t) & = & \exp{(A_{f_*}^T (T - t))} \bar{\lambda}(t) \\
            x(t) & = & \exp{(A_{f_*} t)} x_0 - \int_0^t \exp{(A_{f_*}(t - \tau))} b \rho^{-1} b^T \bar{\lambda}(\tau) d\tau \nonumber
        \end{eqnarray}

        especificamente para nuestro tiempo $T$ y sustituyendo $\bar{\lambda}(t)$ en $x(t)$:

        \begin{equation*}
            x(T) = \exp{(A_{f_*} T)} x_0 - \int_0^T \exp{(A_{f_*}(T - \tau))} b \rho^{-1} b^T \exp{(A_{f_*}^T (T - \tau))} \bar{\lambda}(T) d\tau \bar{\lambda}(T)
        \end{equation*}

        Siendo la parte integral de esta solución el Gramiano de controlabilidad.

        Recordemos que:

        \begin{eqnarray*}
            (A, b) \text{controlable} & \implies & (A_{f_*}, b) \text{controlable} \\
            & \implies & \det{\int_0^T \exp{(A_{f_*}(T - \tau))} b b^T \exp{(A_{f_*}^T (T - \tau))} \bar{\lambda}(T) d\tau} \\
            & \implies & \det{\int_0^T \exp{(A_{f_*}(T - \tau))} b \rho^{-1} b^T \exp{(A_{f_*}^T (T - \tau))} \bar{\lambda}(T) d\tau \bar{\lambda}(T)}
        \end{eqnarray*}

        Asi pues, asumiremos la controlabilidad del par $(A, b)$.

        Sea $x^*$ la trayectoria óptima, por lo que:

        \begin{equation*}
            J(x^*, x_0) \le J(x, x_0)
        \end{equation*}

        para toda solución de la ecuación~\ref{eq:conop1}.

        Entonces, el coestado $\bar{\lambda}^*$ que minimice a $Ja$ será:

        \begin{equation*}
            Ja(x^*, \lambda^*, x_0, \bar{\lambda}(T)) \le Ja(x, \bar{\lambda}, x_0, \bar{\lambda}(T))
        \end{equation*}

        para todo par $(x, \bar{\lambda})$ solución de la ecuación~\ref{eq:conop10} y estará caracterizada por:

        \begin{eqnarray*}
            \bar{\lambda}^*(T) & = & W_c^{-1}(0, T) \left( \exp{(A_{f_*} T)} x_0 - x^*(T) \right) \\
            W_c & = & \int_0^T \exp{\left( A_{f_*}(T-\tau) \right)} b \rho^{-1} b^T \exp{\left( A_{f_*}^T(T-\tau) \right)} d\tau
        \end{eqnarray*}
